<!doctype html>
<html lang="en">
<head>
	{% block head %}
	<meta charset="utf-8" />
	<title>{{ get_project_name() }}</title>
	<link type="text/css" rel="stylesheet" href="{{ static_url('/css/bootstrap.min.css') }}" />
	<link type="text/css" rel="stylesheet" href="{{ static_url('/css/style.css') }}" />
	{% endblock %}
</head>
<body>

{% set info_status = devture_nagios_get_info_status() %}
{% set program_status = devture_nagios_get_program_status() %}
{% set ok_services_count = devture_nagios_get_ok_services_count() %}
{% set failing_services_count = devture_nagios_get_failing_services_count() %}

<div id="wrapper">
	<div class="site-navbar">
		<div class="site-navbar-inner">
			<div class="clearfix">
				<a class="brand" href="{{ path('homepage') }}">
					{{ get_project_name() }}
				</a>
				{% if app.config.nagios_frontend_link is not none %}
					<div class="pull-right">
						{% if program_status is none or info_status is none %}
							<span class="label label-important">Nagios DOWN</span>
						{% else %}
							{% if info_status.appearsOutdated %}
								<span class="label label-important">Nagios {{ info_status.currentVersion }} DOWN?</span>
							{% else %}
								<span class="js-tooltip"
									data-placement="bottom"
									title="PID: {{ program_status.pid }}. Up since: {{ program_status.startTime|date('c') }}"
									>Nagios {{ info_status.currentVersion }}</span>:
							{% endif %}
							<a href="{{ path('devture_nagios.service.manage') }}"
								class="label label-success {{ failing_services_count == 0 ? 'label-nagadmin-success-unobstrusive' : '' }}">
								{{ ok_services_count }} ok
							</a>

							<a href="{{ path('devture_nagios.service.manage') }}"
								class="label label-important {{ failing_services_count == 0 ? 'label-nagadmin-important-unobstrusive' : '' }}">
								{{ failing_services_count }} failing
							</a>
						{% endif %}

						<a class="btn btn-mini" style="margin: 3px;" target="_blank" href="{{ app.config.nagios_frontend_link }}">
							<i class="icon-share-alt"></i>
							Nagios frontend
						</a>
					</div>
				{% endif %}
			</div>
			<div style="clear: both; border-top: 1px solid #ededed;"></div>
			{% include "menu_bar.html.twig" %}
		</div>
	</div>

	<div id="content">
		{% block content %}{% endblock %}
	</div>

	<div id="footer" class="clearfix">
		<hr />

		<div class="pull-left">
			&copy; 2012 - {{ none|date('Y') }}
			<a href="http://devture.com/" target="_blank" title="Devture Ltd - developing your future">Devture Ltd</a>.
		</div>
	</div>
</div>

<script type="text/javascript" src="{{ static_url('/js/jquery-2.0.3.min.js') }}"></script>
<script type="text/javascript" src="{{ static_url('/js/bootstrap.min.js') }}"></script>
<script type="text/javascript" src="{{ static_url('/js/comploader/comploader.js') }}"></script>

<script type="text/javascript">
	{% include 'comploader_components.js.twig' %}
</script>

<script type="text/javascript">
{% block js %}
	$('.js-tooltip').tooltip();

	$(function () {
		var $chosenSelects = $('.js-chosen-select');
		if ($chosenSelects.length > 0) {
			comploader.load("chosen", function () {
				$chosenSelects.chosen();
			});
		}

		var $relativeTimes = $('.js-relative-time');
		if ($relativeTimes.length > 0) {
			comploader.load("relative-time", function () {
				$relativeTimes.relativeTime().tooltip();
			});
		}

		var $textareas = $('textarea');
		if ($textareas.length > 0) {
			comploader.load("jquery.autoresize", function () {
				$textareas.autoResize({"extraSpace": 10});
			});
		}
	});

	(function () {
		var lazyNgAppLoad = function () {
			$('[ng-app-lazy]').each(function () {
				var $appRoot = $(this),
					appName = $appRoot.attr('ng-app-lazy');

				if ($appRoot.data('bootstrapped')) {
					return;
				}
				$appRoot.data('bootstrapped', true);

				comploader.load(appName, function () {
					angular.bootstrap($appRoot, [appName]);
				});
			});
		};

		$(lazyNgAppLoad);
	})();
{% endblock %}
</script>

</body>
</html>