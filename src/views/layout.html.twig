<!doctype html>
<html lang="en">
<head>
	{% block head %}
	<meta charset="utf-8" />
	<title>{{ get_project_name() }}</title>
	<link type="text/css" rel="stylesheet" href="{{ static_url('/css/bootstrap.min.css') }}" />
	<link type="text/css" rel="stylesheet" href="{{ static_url('/css/style.css') }}" />
	<link type="text/css" rel="stylesheet" href="{{ static_url('/js/chosen/chosen.css') }}" />
	{% endblock %}
</head>
<body>

{% set info_status = devture_nagios_get_info_status() %}
{% set program_status = devture_nagios_get_program_status() %}
{% set ok_services_count = devture_nagios_get_ok_services_count() %}
{% set failing_services_count = devture_nagios_get_failing_services_count() %}

<div id="wrapper">
	<div class="site-navbar">
		<div class="site-navbar-inner">
			<div class="clearfix">
				<a class="brand" href="{{ path('homepage') }}">
					{{ get_project_name() }}
				</a>
				{% if app.config.nagios_frontend_link is not none %}
					<div class="pull-right">
						{% if program_status is none or info_status is none %}
							<span class="label label-important">Nagios DOWN</span>
						{% else %}
							<span class="js-tooltip"
								data-placement="bottom"
								title="PID: {{ program_status.pid }}. Up since: {{ program_status.startTime|date('c') }}"
								>Nagios {{ info_status.currentVersion }}</span>:

							<a href="{{ path('devture_nagios.service.manage') }}"
								class="label label-success {{ failing_services_count == 0 ? 'label-nagadmin-success-unobstrusive' : '' }}">
								{{ ok_services_count }} ok
							</a>

							<a href="{{ path('devture_nagios.service.manage') }}"
								class="label label-important {{ failing_services_count == 0 ? 'label-nagadmin-important-unobstrusive' : '' }}">
								{{ failing_services_count }} failing
							</a>
						{% endif %}

						<a class="btn btn-mini" style="margin: 3px;" target="_blank" href="{{ app.config.nagios_frontend_link }}">
							<i class="icon-share-alt"></i>
							Nagios frontend
						</a>
					</div>
				{% endif %}
			</div>
			<div style="clear: both; border-top: 1px solid #ededed;"></div>
			{% include "menu_bar.html.twig" %}
		</div>
	</div>

	<div id="content">
		{% if program_status is none or info_status is none %}
			<p class="alert alert-error">
				<i class="icon-exclamation-sign"></i>
				Nagios does not appear to be running or the status file path is not configured correctly.
			</p>
		{% endif %}

		{% block content %}{% endblock %}
	</div>

	<div id="footer" class="clearfix">
		<hr />

		<div class="pull-left">
			&copy; 2012 - {{ none|date('Y') }}
			<a href="http://devture.com/" target="_blank" title="Devture Ltd - developing your future">Devture Ltd</a>.
		</div>
	</div>
</div>

<script type="text/javascript" src="{{ static_url('/js/jquery-2.0.0.min.js') }}"></script>
<script type="text/javascript" src="{{ static_url('/js/bootstrap.min.js') }}"></script>
<script type="text/javascript" src="{{ static_url('/js/jquery.autoresize.js') }}"></script>
<script type="text/javascript" src="{{ static_url('/js/jquery.relative-time.js') }}"></script>
<script type="text/javascript" src="{{ static_url('/js/chosen/chosen.jquery.min.js') }}"></script>

<script type="text/javascript">
{% block js %}
	$('textarea').autoResize({"extraSpace": 10});

	$('.js-chosen-select').chosen();

	$('.js-tooltip').tooltip();

	$('.js-relative-time').relativeTime().tooltip();
{% endblock %}
</script>

</body>
</html>